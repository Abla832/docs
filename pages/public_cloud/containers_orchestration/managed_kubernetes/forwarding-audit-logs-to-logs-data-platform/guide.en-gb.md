---
title: Managed Kubernetes Service Audit Logs Forwarding
excerpt: 'Find out how to forward Audit logs from an OVH Managed Kubernetes Service cluster to Logs Data Platform'
updated: 2023-06-30
---


 
## Objective
In this guide, you will learn how to enable the forwarding of the audit logs of your OVHcloud Managed Kubernetes cluster to Logs Data Platform, a platform that helps you store, archive, query and visualize your logs.
To discover Logs Data Platform before continuing this guide, please refer to [Log Data Platform introduction guide](https://help.ovhcloud.com/csm/en-gb-logs-data-platform-introduction?id=kb_article_view&sysparm_article=KB0058312).

### Glossary
- **Logs Data Platform:** fully managed and secured log management platform proposed by OVHcloud. Find more information on the Logs Data Platform service page.
- **Data Stream:** a logical partition of logs that you create in an LDP account that you will use when ingesting, visualizing or querying your logs. Multiple sources can be stored in the same data stream, and it is the unit for defining a logs pipeline (retention policy, archiving, live streaming...), access rights and alert policies.
- **Logs forwarding:** feature integrated in an OVHcloud product to ingest logs from its services to a data stream of an LDP account in the same OVHcloud account. The feature has to be enabled by the customer per service.
- **Logs forwarding Subscription:** when enabling the logs forwarding for a given OVHcloud service to a given LDP data stream, a subscription is created and attached to the data stream for further management by the customer.
- **Request stage and audit level:**  audit records begin their lifecycle inside the kube-apiserver component. Each request on each stage of its execution generates an audit event, which is then pre-processed according to the policy defined by the OVHcloud Managed Kubernetes Service. This policy defines which audit events as well as which audit level (meaning which events data) are forwarded through the Audit logs of your Kubernetes cluster. For more details, refer to the Kubernetes Auditing documentation.  

## Requirements
To follow this guide, you will need:
-	a Logs Data Platform (LDP) account with at least one active stream configured. This guide will walk you through all the necessary steps.
-	an up-and-running Managed Kubernetes Service (K8s) cluster. This guide will walk you through the steps as well.
Both LDP account and K8s cluster must belong to the same OVHcloud accounts

## Instructions
What are audit logs of a Managed Kubernetes cluster?

Managed Kubernetes audit logs provide a security-relevant, chronological set of records documenting the sequence of actions in your cluster.
The cluster audits the activities generated by users, by applications that use the Kubernetes API, and by the control plane itself. Auditing allows cluster administrators to know what happened, when, who initiated it from where, on what did it happen and to where was it going. For further details about cluster audits, refer to the Kubernetes auditing documentation.

The OVHcloud Managed Kubernetes Service has defined audit policy, enabling you to retrieve logs pertaining to:
-	requests to authorization resources to help troubleshoot authentication issues
-	configmap and secret changes in all namespaces at the Metadata audit level
-	changes to resources at RequestResponse level (maximum verbosity) to create, patch, update and delete verbs
-	changes to resources at Request level for other verbs
-	all other requests at the Metadata level

Note:
-	No logs for requests by the "system:kube-proxy" on endpoints or services
-	Low level of verbosity (level Metadata) for endpoints containing sensitive data like tokenreview
-	No logs for any request in the RequestReceived stage
-	No logs for health checks and requests for apiserver metrics


For details about information capture in Kubernetes Audit logs you can refer to the  Kubernetes public documentation.
Above, you will find an example of an audit log generated by a Kubernetes cluster.
Note the example is not exhaustive.

## How to enable the forwarding?
### Using the Manager
### Using APIs
Currently, you can only enable the forwarding of the audit logs per Kubernetes cluster via API. You will have to define the target Stream of one of your LDP account you aim these logs to be forwarded to. The enablement of the forwarding will create a subscription for this stream id.
Note that the forwarding enablement is free of charge, but you will be charged for the usage of Logs Data Platform service as per standard price plan. For LDP pricing refer to Logs Data Platform product page.
As per example below the POST request has a payload containing a streamId, which is the target data stream of your LDP account where you aim your Kubernetes cluster Audit logs will be forwarded. You will get in response an operationid, so you can use it to retrieve the subscriptionid further management purposes using Logs Data Platform read operation endpoint.
You can retrieve the API specification in OVH API Console.
 You can find your streamId, in Logs Data Platform control panel of your account in Data stream” pan when editing a stream:
-	Got to the “Data Stream” page of your Logs Data Platform account and “Edit” the target Data Stream

https://www.ovh.com/manager/#/dedicated/dbaas/logs/{ldp-account-id}/streams/home
-	Copy the streamId page of your Logs Data Platform account.

https://www.ovh.com/manager/#/dedicated/dbaas/logs/{ldp-account-id}/streams/{streamid}/edit

Alternatively, you can retrieve your streamed using Logs Data Platform API:
-	List data stream of you Logs Data Platform account
    /dbaas/logs/{serviceName}/output/graylog/stream
-	Get the details of a data stream
   /dbaas/logs/{serviceName}/output/graylog/stream/{streamId}

How to use your Kubernetes Audit logs?
Now that your Kubernetes instance Audit logs are ingested and stored in your Logs Data Platform data stream, you can query your logs and build dashboards to have a graphical representation of your logs using web-based UI of Graylog.
-	Retrieve the admin user (<> Logs Data Platform service) and its password in your Logs Data Platform account home page.
-	Open the Graylog web-ui. You can retrieve le linke in your account home page or using your Access point depending of your account region (for example: Gravelines regions https://gra1.logs.ovh.com/ )

https://www.ovh.com/manager/#/dedicated/dbaas/logs/ldp-qz-47460/home
 
-	Login Graylog using your Logs Data Platform service name and Password

https://gra1.logs.ovh.com/
-	Search your through your logs across the data stream of your Logs Data Platform account. You can refer to Graylog writing search qyeries documentation for details on search syntax.


For more details about how to use your logs with Logs Data Platform, including:
-	how to setup alerts,
-	view the logs in real time through a WebSocket,
-	build visualization with OpenSearch Dashboards,
-	integrate with OpenSearch API
-	to connect with Grafana

	refer to following documentation Logs Data Platform - Visualizing, querying and exploiting your logs.

 
## How to manage your subscriptions?

At any point, you can retrieve subscriptions attached to your Logs Data Platform data stream and choose to disable the forwarding by cancelling your subscription on your stream so that your Logs Data Platform stream doesn't receive your audit logs anymore.

Note that this doesn't delete the logs that have been stored prior to the subscription cancellation, as data stored in a logs stream is immutable unless you delete the entire stream.

Currently, you can only manage your subscriptions via Logs Data Platform’s API.

The three following Logs Data Platform’s API routes respectively allow you to:
-	retrieve a list of subscription IDs associated with a specific logs stream based on its streamID
-	retrieve the information (such as the resource type, in this case Managed Kubernetes, and resource name – the UUID of your Managed Kubernetes cluster) of the service associated with the subscription based on its subscriptionId.
- delete a subscription based on its subscriptionId.
Retrieve these API specification in OVH API console for LDP in /dbaas/logs
Go further
Any feedback or issue using this new forwarding feature during the BETA contact Kubernetes and Logs Data Platform teams through the dedidcated private discord channel : Kubernetes channel on OVHcloud Discord


## Go further

- If you need training or technical assistance to implement our solutions, contact your sales representative or click on [this link](https://www.ovhcloud.com/en-gb/professional-services/) to get a quote and ask our Professional Services experts for assisting you on your specific use case of your project.

- Join our community of users on <https://community.ovh.com/en/>.
